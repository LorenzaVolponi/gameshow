<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Host - Conselheiro vs M√°quina</title>
  <style>
    :root {
      --primary-color: #667eea;
      --primary-dark: #5568d3;
      --success-color: #48bb78;
      --danger-color: #f56565;
      --warning-color: #ed8936;
      --bg-light: #f7fafc;
      --text-dark: #2d3748;
      --text-gray: #666;
      --border-color: #e2e8f0;
      --spacing-xs: 8px;
      --spacing-sm: 12px;
      --spacing-md: 16px;
      --spacing-lg: 20px;
      --spacing-xl: 30px;
      --btn-min-height: 48px;
      --radius-sm: 8px;
      --radius-md: 12px;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, var(--primary-color) 0%, #764ba2 100%);
      min-height: 100vh;
      padding: var(--spacing-lg);
      padding-bottom: 80px;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: var(--radius-md);
      padding: var(--spacing-xl);
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    h1 {
      color: var(--primary-color);
      margin-bottom: 10px;
      font-size: clamp(24px, 5vw, 32px);
    }
    .subtitle {
      color: var(--text-gray);
      margin-bottom: var(--spacing-xl);
      font-size: clamp(14px, 3vw, 16px);
    }
    .status {
      background: #f7fafc;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      border-left: 4px solid #667eea;
    }
    .status-info {
      font-size: 24px;
      font-weight: bold;
      color: #667eea;
      margin-bottom: 10px;
    }
    .question-input {
      width: 100%;
      padding: 15px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-size: 16px;
      margin-bottom: 10px;
      resize: vertical;
      min-height: 80px;
    }
    .char-count {
      text-align: right;
      color: #666;
      font-size: 12px;
      margin-bottom: 15px;
    }
    .char-count.warning {
      color: #e53e3e;
    }
    .btn {
      min-height: var(--btn-min-height);
      padding: var(--spacing-sm) var(--spacing-lg);
      border: none;
      border-radius: var(--radius-sm);
      font-size: clamp(14px, 3.5vw, 16px);
      font-weight: 600;
      cursor: pointer;
      margin-right: 10px;
      margin-bottom: 10px;
      transition: all 0.3s;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
    }
    .btn-primary {
      background: var(--primary-color);
      color: white;
    }
    .btn-primary:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }
    .btn-primary:active {
      transform: translateY(0);
    }
    .btn-success {
      background: var(--success-color);
      color: white;
    }
    .btn-success:hover {
      background: #38a169;
    }
    .btn-success:active {
      transform: translateY(0);
    }
    .btn-danger {
      background: var(--danger-color);
      color: white;
    }
    .btn-danger:hover {
      background: #e53e3e;
    }
    .btn-danger:active {
      transform: translateY(0);
    }
    .btn-warning {
      background: var(--warning-color);
      color: white;
    }
    .btn-warning:hover {
      background: #dd6b20;
    }
    .btn-warning:active {
      transform: translateY(0);
    }
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
    .section {
      margin: 20px 0;
      padding: 20px;
      background: #f7fafc;
      border-radius: 8px;
      border-left: 4px solid #667eea;
    }
    .section h3 {
      margin-bottom: 15px;
      color: #2d3748;
      font-size: 18px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .question-item {
      margin-bottom: 20px;
    }
    .question-label {
      font-weight: 600;
      color: #4a5568;
      margin-bottom: 8px;
      display: block;
    }
    .groups-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: 10px;
      margin: 15px 0;
    }
    .group-badge {
      padding: 10px;
      border-radius: 6px;
      text-align: center;
      font-weight: 600;
      background: #edf2f7;
      color: #4a5568;
    }
    .group-badge.active {
      background: #48bb78;
      color: white;
    }
    .response-item {
      padding: 15px;
      background: white;
      border-radius: 8px;
      margin-bottom: 15px;
      border: 2px solid #e2e8f0;
      word-wrap: break-word;
      overflow-wrap: break-word;
    }
    .response-label {
      font-weight: bold;
      color: #667eea;
      margin-bottom: 10px;
      font-size: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .ia-badge {
      background: #ed8936;
      color: white;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 13px;
    }
    .human-badge {
      background: #48bb78;
      color: white;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 13px;
    }
    .reveal-box {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-top: 15px;
      border: 2px solid #667eea;
    }
    .reveal-box h4 {
      color: #667eea;
      margin-bottom: 20px;
      font-size: 20px;
      text-align: center;
    }
    .finished {
      text-align: center;
      padding: 40px;
      background: #48bb78;
      color: white;
      border-radius: 12px;
      font-size: 24px;
      font-weight: bold;
    }
    .navigation-buttons {
      display: flex;
      gap: 10px;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    /* Acorde√µes Colaps√°veis */
    .accordion-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      user-select: none;
      padding: var(--spacing-md);
      background: var(--bg-light);
      border-radius: var(--radius-sm);
      margin-bottom: var(--spacing-sm);
      border: 2px solid var(--border-color);
      transition: all 0.3s;
    }
    .accordion-header:active {
      background: #e2e8f0;
    }
    .accordion-header h3 {
      margin: 0;
      font-size: clamp(16px, 4vw, 18px);
    }
    .accordion-icon {
      font-size: 20px;
      transition: transform 0.3s;
    }
    .accordion-header.collapsed .accordion-icon {
      transform: rotate(-90deg);
    }
    .accordion-content {
      max-height: 5000px;
      overflow: hidden;
      transition: max-height 0.3s ease-out, opacity 0.3s;
      opacity: 1;
    }
    .accordion-content.collapsed {
      max-height: 0;
      opacity: 0;
    }

    /* Barra Inferior Fixa (Mobile) */
    .bottom-bar {
      display: none;
    }
    
    /* Desktop Controls */
    .desktop-controls {
      display: block;
    }

    /* Media Queries Mobile */
    @media (max-width: 768px) {
      body {
        padding: var(--spacing-sm);
        padding-bottom: 100px;
      }
      .container {
        padding: var(--spacing-md);
        border-radius: var(--radius-sm);
      }
      h1 {
        font-size: 22px;
      }
      .subtitle {
        font-size: 13px;
        margin-bottom: var(--spacing-md);
      }
      .status {
        padding: var(--spacing-md);
      }
      .status-info {
        font-size: 18px;
      }
      .section {
        padding: var(--spacing-md);
        margin: var(--spacing-sm) 0;
      }
      .section h3 {
        font-size: 16px;
      }
      .question-input {
        font-size: 15px;
        padding: var(--spacing-sm);
        min-height: 70px;
      }
      .btn {
        width: 100%;
        margin-right: 0;
        margin-bottom: var(--spacing-sm);
        font-size: 15px;
        padding: var(--spacing-md);
      }
      .navigation-buttons .btn {
        flex: 1;
        min-width: 120px;
      }
      .groups-list {
        grid-template-columns: repeat(3, 1fr);
        gap: var(--spacing-xs);
      }
      .group-badge {
        padding: var(--spacing-xs);
        font-size: 13px;
      }
      .response-item {
        padding: var(--spacing-sm);
        font-size: 14px;
      }
      .response-label {
        font-size: 14px;
      }
      .reveal-box {
        padding: var(--spacing-md);
      }
      .reveal-box h4 {
        font-size: 16px;
      }
      .finished {
        padding: var(--spacing-lg);
        font-size: 18px;
      }

      /* Ocultar controles desktop em mobile */
      .desktop-controls {
        display: none !important;
      }

      /* Barra Inferior Fixa */
      .bottom-bar {
        display: flex;
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: white;
        border-top: 2px solid var(--border-color);
        padding: var(--spacing-sm);
        gap: var(--spacing-xs);
        box-shadow: 0 -4px 12px rgba(0,0,0,0.1);
        z-index: 1000;
      }
      .bottom-bar .btn {
        flex: 1;
        margin: 0;
        font-size: 13px;
        padding: var(--spacing-sm);
      }
    }

    @media (max-width: 400px) {
      .groups-list {
        grid-template-columns: repeat(3, 1fr);
      }
      .navigation-buttons {
        flex-direction: column;
      }
      .navigation-buttons .btn {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üéÆ Conselheiro vs M√°quina</h1>
    <p class="subtitle">Painel de Controle do Host</p>

    <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
      <a href="qr.html" target="_blank" style="text-decoration: none;">
        <button class="btn btn-primary">üì± QR Codes Grupos</button>
      </a>
    </div>

    <div class="status">
      <div class="status-info" id="statusInfo">Aguardando configura√ß√£o...</div>
      <div id="questionPreview"></div>
    </div>

    <!-- TELA DE CONFIGURA√á√ÉO -->
    <div id="controlsConfig">
      <div class="section">
        <h3>‚öôÔ∏è Configurar 4 Perguntas do Jogo</h3>
        
        <div class="question-item">
          <label class="question-label">Pergunta 1:</label>
          <textarea id="q1Input" class="question-input" placeholder="Digite a primeira pergunta..." maxlength="500" oninput="updateCharCount('q1Input', 'charCount1')"></textarea>
          <div id="charCount1" class="char-count">0 / 500 caracteres</div>
        </div>

        <div class="question-item">
          <label class="question-label">Pergunta 2:</label>
          <textarea id="q2Input" class="question-input" placeholder="Digite a segunda pergunta..." maxlength="500" oninput="updateCharCount('q2Input', 'charCount2')"></textarea>
          <div id="charCount2" class="char-count">0 / 500 caracteres</div>
        </div>

        <div class="question-item">
          <label class="question-label">Pergunta 3:</label>
          <textarea id="q3Input" class="question-input" placeholder="Digite a terceira pergunta..." maxlength="500" oninput="updateCharCount('q3Input', 'charCount3')"></textarea>
          <div id="charCount3" class="char-count">0 / 500 caracteres</div>
        </div>

        <div class="question-item">
          <label class="question-label">Pergunta 4:</label>
          <textarea id="q4Input" class="question-input" placeholder="Digite a quarta pergunta..." maxlength="500" oninput="updateCharCount('q4Input', 'charCount4')"></textarea>
          <div id="charCount4" class="char-count">0 / 500 caracteres</div>
        </div>

        <button class="btn btn-success" onclick="saveAndStartGame()">‚úÖ Salvar e Iniciar Jogo</button>
      </div>
    </div>

    <!-- TELA DE JOGO -->
    <div id="controlsGame" style="display: none;">
      <!-- Se√ß√£o: Grupos -->
      <div class="accordion-header" data-accordion="accordionGroups" onclick="toggleAccordion('accordionGroups')">
        <h3>üìù Grupos que responderam</h3>
        <span class="accordion-icon">‚ñº</span>
      </div>
      <div id="accordionGroups" class="accordion-content">
        <div class="section" style="margin-top: 0; border-left: none;">
          <div class="groups-list" id="groupsList">
            <div class="group-badge">G1</div>
            <div class="group-badge">G2</div>
            <div class="group-badge">G3</div>
            <div class="group-badge">G4</div>
            <div class="group-badge">G5</div>
            <div class="group-badge">G6</div>
            <div class="group-badge">G7</div>
            <div class="group-badge">G8</div>
            <div class="group-badge">G9</div>
          </div>
        </div>
      </div>

      <!-- Se√ß√£o: Respostas -->
      <div class="accordion-header" data-accordion="accordionResponses" onclick="toggleAccordion('accordionResponses')">
        <h3>üìã Respostas da Pergunta</h3>
        <span class="accordion-icon">‚ñº</span>
      </div>
      <div id="accordionResponses" class="accordion-content">
        <div class="section" style="margin-top: 0; border-left: none;">
          <div id="responsesDisplay" style="margin-bottom: 15px;">
            <div style="color: #666; font-style: italic;">Aguardando respostas dos grupos...</div>
          </div>
        </div>
      </div>

      <!-- Se√ß√£o: Revelar -->
      <div class="accordion-header" data-accordion="accordionReveal" onclick="toggleAccordion('accordionReveal')">
        <h3>üëÅÔ∏è Revelar Resultados</h3>
        <span class="accordion-icon">‚ñº</span>
      </div>
      <div id="accordionReveal" class="accordion-content collapsed">
        <div class="section" style="margin-top: 0; border-left: none;">
          <div id="revealDisplay"></div>
        </div>
      </div>

      <!-- Controles Desktop (ocultos em mobile) -->
      <div class="desktop-controls" style="margin-top: 20px;">
        <button class="btn btn-warning" onclick="generateIA()" id="btnGenerateIA">‚ö° Gerar Resposta da IA</button>
        <button class="btn btn-danger" onclick="revealCurrent()" id="btnReveal">üëÅÔ∏è Revelar IA vs Humano</button>
        <div class="navigation-buttons">
          <button class="btn btn-primary" onclick="previousQuestion()" id="btnPrevious">‚óÄ Pergunta Anterior</button>
          <button class="btn btn-primary" onclick="nextQuestion()" id="btnNext">Pr√≥xima Pergunta ‚ñ∂</button>
        </div>
      </div>
    </div>

    <!-- Barra Inferior (Mobile) -->
    <div class="bottom-bar">
      <button class="btn btn-primary" onclick="previousQuestion()" id="btnPreviousMobile">‚óÄ</button>
      <button class="btn btn-warning" onclick="generateIA()" id="btnGenerateIAMobile">ü§ñ IA</button>
      <button class="btn btn-danger" onclick="revealCurrent()" id="btnRevealMobile">üëÅÔ∏è Revelar</button>
      <button class="btn btn-primary" onclick="nextQuestion()" id="btnNextMobile">‚ñ∂</button>
    </div>

    <!-- TELA FINAL -->
    <div id="finishedScreen" style="display: none;">
      <div class="finished">
        üéâ Jogo Finalizado! Todas as 4 perguntas foram completadas.
      </div>
    </div>
  </div>

  <script>
    const ROOM = 'default';
    const API_BASE = window.location.origin;
    let pollingInterval;
    let currentState = {};
    let isFetching = false;

    function updateCharCount(textareaId, counterId) {
      const textarea = document.getElementById(textareaId);
      const counter = document.getElementById(counterId);
      const length = textarea.value.length;
      const maxLength = textarea.maxLength;
      counter.textContent = `${length} / ${maxLength} caracteres`;
      counter.className = length > maxLength * 0.9 ? 'char-count warning' : 'char-count';
    }

    async function fetchState() {
      if (isFetching) return;
      
      isFetching = true;
      try {
        const res = await fetch(`${API_BASE}/api/state?room=${ROOM}`);
        const data = await res.json();
        currentState = data;
        updateUI(data);
      } catch (err) {
        console.error('Error fetching state:', err);
      } finally {
        isFetching = false;
      }
    }

    function updateUI(state) {
      const statusInfo = document.getElementById('statusInfo');
      const questionPreview = document.getElementById('questionPreview');
      const controlsConfig = document.getElementById('controlsConfig');
      const controlsGame = document.getElementById('controlsGame');
      const finishedScreen = document.getElementById('finishedScreen');
      const bottomBar = document.querySelector('.bottom-bar');

      if (state.currentQuestion === -1) {
        statusInfo.textContent = 'Aguardando configura√ß√£o...';
        questionPreview.textContent = '';
        controlsConfig.style.display = 'block';
        controlsGame.style.display = 'none';
        finishedScreen.style.display = 'none';
        if (bottomBar) bottomBar.style.display = 'none';
      } else if (state.currentQuestion > 3) {
        controlsConfig.style.display = 'none';
        controlsGame.style.display = 'none';
        finishedScreen.style.display = 'block';
        if (bottomBar) bottomBar.style.display = 'none';
      } else {
        const questionNum = state.currentQuestion + 1;
        statusInfo.textContent = `Pergunta ${questionNum} de 4`;
        const currentQuestion = state.questions[state.currentQuestion] || '';
        questionPreview.innerHTML = `<strong>Pergunta:</strong> ${currentQuestion}`;
        controlsConfig.style.display = 'none';
        controlsGame.style.display = 'block';
        finishedScreen.style.display = 'none';
        if (bottomBar) {
          if (window.innerWidth <= 768) {
            bottomBar.style.display = 'flex';
          } else {
            bottomBar.style.display = 'none';
          }
        }

        updateGroupsList(state);
        updateResponsesDisplay(state);
        updateRevealDisplay(state);
        updateNavigationButtons(state);
      }
    }

    function updateGroupsList(state) {
      const groups = ['G1', 'G2', 'G3', 'G4', 'G5', 'G6', 'G7', 'G8', 'G9'];
      const groupsList = document.getElementById('groupsList');
      const questionKey = `q${state.currentQuestion}`;
      const responses = state.responses[questionKey] || {};

      groupsList.innerHTML = groups.map(g => {
        const hasResponse = responses[g];
        return `<div class="group-badge ${hasResponse ? 'active' : ''}">${g}</div>`;
      }).join('');
    }

    function updateResponsesDisplay(state) {
      const questionKey = `q${state.currentQuestion}`;
      const responses = state.responses[questionKey] || {};
      const hasResponses = Object.keys(responses).filter(k => k !== 'IA').length > 0;
      const hasIA = responses.IA;
      
      let html = '';

      if (hasResponses || hasIA) {
        if (hasResponses) {
          html += '<div style="margin-bottom: 15px;"><strong style="color: #48bb78;">üë• Respostas dos Grupos:</strong></div>';
          Object.entries(responses).forEach(([key, response]) => {
            if (key !== 'IA') {
              html += `
                <div class="response-item">
                  <div class="response-label">
                    <span>${key}</span>
                    <span class="human-badge">Humano</span>
                  </div>
                  <div style="color: #4a5568; line-height: 1.6;">${response}</div>
                </div>
              `;
            }
          });
        }
        
        if (hasIA) {
          html += '<div style="margin: 20px 0 10px 0;"><strong style="color: #ed8936;">ü§ñ Resposta da IA:</strong></div>';
          html += `
            <div class="response-item">
              <div class="response-label">
                <span>Groq LLaMA 3.1</span>
                <span class="ia-badge">IA</span>
              </div>
              <div style="color: #4a5568; line-height: 1.6;">${responses.IA}</div>
            </div>
          `;
        }
        
        document.getElementById('responsesDisplay').innerHTML = html;
      } else {
        document.getElementById('responsesDisplay').innerHTML = '<div style="color: #666; font-style: italic;">Aguardando respostas dos grupos...</div>';
      }
    }

    function updateRevealDisplay(state) {
      const questionKey = `q${state.currentQuestion}`;
      const revealed = state.revealed[questionKey];
      
      if (!revealed) {
        document.getElementById('revealDisplay').innerHTML = '';
        return;
      }

      const responses = state.responses[questionKey] || {};
      let html = '<div class="reveal-box">';
      html += '<h4>üéØ Resultados da Pergunta</h4>';

      Object.entries(responses).forEach(([key, response]) => {
        const isIA = key === 'IA';
        const badge = isIA ? '<span class="ia-badge">ü§ñ IA</span>' : `<span class="human-badge">üë• ${key}</span>`;
        
        html += `<div class="response-item">`;
        html += `<div class="response-label">${badge}</div>`;
        html += `<div style="color: #4a5568; line-height: 1.6;">${response || '<em>Sem resposta</em>'}</div>`;
        html += `</div>`;
      });

      html += '</div>';
      document.getElementById('revealDisplay').innerHTML = html;
    }

    function updateNavigationButtons(state) {
      const btnPrevious = document.getElementById('btnPrevious');
      const btnNext = document.getElementById('btnNext');
      const btnPreviousMobile = document.getElementById('btnPreviousMobile');
      const btnNextMobile = document.getElementById('btnNextMobile');

      const isPrevDisabled = state.currentQuestion === 0;
      btnPrevious.disabled = isPrevDisabled;
      if (btnPreviousMobile) btnPreviousMobile.disabled = isPrevDisabled;

      if (state.currentQuestion === 3) {
        btnNext.textContent = 'Finalizar Jogo ‚úì';
        btnNext.disabled = false;
        if (btnNextMobile) {
          btnNextMobile.textContent = '‚úì';
          btnNextMobile.disabled = false;
        }
      } else {
        btnNext.textContent = 'Pr√≥xima Pergunta ‚ñ∂';
        btnNext.disabled = false;
        if (btnNextMobile) {
          btnNextMobile.textContent = '‚ñ∂';
          btnNextMobile.disabled = false;
        }
      }
    }

    async function updateState(updates) {
      try {
        const res = await fetch(`${API_BASE}/api/update`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ room: ROOM, updates })
        });
        const data = await res.json();
        if (data.success) {
          await fetchState();
        }
      } catch (err) {
        console.error('Error updating state:', err);
      }
    }

    async function saveAndStartGame() {
      const q1 = document.getElementById('q1Input').value.trim();
      const q2 = document.getElementById('q2Input').value.trim();
      const q3 = document.getElementById('q3Input').value.trim();
      const q4 = document.getElementById('q4Input').value.trim();

      if (!q1 || !q2 || !q3 || !q4) {
        alert('Por favor, preencha todas as 4 perguntas antes de iniciar o jogo.');
        return;
      }

      try {
        const res = await fetch(`${API_BASE}/api/update`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ 
            room: ROOM, 
            updates: {
              questions: [q1, q2, q3, q4],
              currentQuestion: 0
            }
          })
        });

        const data = await res.json();
        if (data.success) {
          const clearRes = await fetch(`${API_BASE}/api/update`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
              room: ROOM, 
              updates: {
                responses: {
                  q0: {},
                  q1: {},
                  q2: {},
                  q3: {}
                },
                revealed: {
                  q0: false,
                  q1: false,
                  q2: false,
                  q3: false
                }
              }
            })
          });

          if (clearRes.ok) {
            await fetchState();
            alert('‚úÖ Jogo iniciado! Aguarde as respostas dos grupos.');
          }
        }
      } catch (err) {
        console.error('Error starting game:', err);
        alert('‚ùå Erro ao iniciar jogo. Tente novamente.');
      }
    }

    async function generateIA() {
      const btnDesktop = document.getElementById('btnGenerateIA');
      const btnMobile = document.getElementById('btnGenerateIAMobile');
      
      if (btnDesktop) {
        btnDesktop.disabled = true;
        btnDesktop.textContent = '‚è≥ Gerando IA (pode levar alguns segundos)...';
      }
      if (btnMobile) {
        btnMobile.disabled = true;
        btnMobile.textContent = '‚è≥';
      }

      try {
        const currentQuestion = currentState.questions[currentState.currentQuestion];
        const res = await fetch(`${API_BASE}/api/ia`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ 
            room: ROOM, 
            question: currentQuestion,
            saveToState: true
          })
        });

        const data = await res.json();
        
        if (data.success) {
          await fetchState();
          alert('‚úÖ IA gerada com sucesso!');
        } else {
          alert('‚ùå Erro: ' + (data.error || 'Erro ao gerar IA'));
        }
      } catch (err) {
        console.error('Error generating IA:', err);
        alert('‚ùå Erro ao gerar IA. Verifique sua conex√£o e tente novamente.');
      } finally {
        if (btnDesktop) {
          btnDesktop.disabled = false;
          btnDesktop.textContent = '‚ö° Gerar Resposta da IA';
        }
        if (btnMobile) {
          btnMobile.disabled = false;
          btnMobile.textContent = 'ü§ñ IA';
        }
      }
    }

    async function revealCurrent() {
      const btnDesktop = document.getElementById('btnReveal');
      const btnMobile = document.getElementById('btnRevealMobile');
      
      if (btnDesktop) btnDesktop.disabled = true;
      if (btnMobile) btnMobile.disabled = true;
      
      try {
        const questionKey = `q${currentState.currentQuestion}`;
        const responses = currentState.responses[questionKey] || {};
        
        if (Object.keys(responses).length === 0) {
          alert('N√£o h√° respostas para revelar ainda!');
          return;
        }

        await updateState({
          revealed: {
            ...currentState.revealed,
            [questionKey]: true
          }
        });

        alert('üëÅ Resultados revelados!');
      } finally {
        if (btnDesktop) btnDesktop.disabled = false;
        if (btnMobile) btnMobile.disabled = false;
      }
    }

    async function nextQuestion() {
      if (currentState.currentQuestion >= 3) {
        await updateState({ currentQuestion: 4 });
        alert('üéâ Jogo finalizado!');
        return;
      }

      await updateState({ 
        currentQuestion: currentState.currentQuestion + 1 
      });
    }

    async function previousQuestion() {
      if (currentState.currentQuestion > 0) {
        await updateState({ 
          currentQuestion: currentState.currentQuestion - 1 
        });
      }
    }

    // Acorde√µes colaps√°veis
    function toggleAccordion(id) {
      const header = document.querySelector(`[data-accordion="${id}"]`);
      const content = document.getElementById(id);
      
      if (!header || !content) return;
      
      const isCollapsed = content.classList.contains('collapsed');
      
      if (isCollapsed) {
        content.classList.remove('collapsed');
        header.classList.remove('collapsed');
      } else {
        content.classList.add('collapsed');
        header.classList.add('collapsed');
      }
    }

    fetchState();
    pollingInterval = setInterval(fetchState, 500);
  </script>
</body>
</html>
